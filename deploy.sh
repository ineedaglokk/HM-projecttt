#!/bin/bash

# üöÄ –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –•–∞—á–∞–ø—É—Ä–∏ –ú–∞—Ä–∏–∫–æ
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: bash deploy.sh

echo "üá¨üá™ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –•–∞—á–∞–ø—É—Ä–∏ –ú–∞—Ä–∏–∫–æ..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Node.js
if ! command -v node &> /dev/null; then
    echo "‚ùå Node.js –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
    echo "üì• –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js: https://nodejs.org/"
    echo "üí° –î–ª—è macOS: brew install node"
    exit 1
fi

echo "‚úÖ Node.js $(node --version) –Ω–∞–π–¥–µ–Ω"
echo "‚úÖ npm $(npm --version) –Ω–∞–π–¥–µ–Ω"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Mini App..."
npm install

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–∞–ø–∫–∏ bot
if [ ! -d "bot" ]; then
    echo "‚ùå –ü–∞–ø–∫–∞ bot –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
    exit 1
fi

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –±–æ—Ç–∞
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Telegram Bot..."
cd bot
npm install
cd ..

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ .env –¥–ª—è –±–æ—Ç–∞
if [ ! -f "bot/.env" ]; then
    echo "‚ö†Ô∏è  –§–∞–π–ª bot/.env –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "üìù –°–æ–∑–¥–∞—é –∏–∑ —à–∞–±–ª–æ–Ω–∞..."
    cp bot/env.example bot/.env
    echo "‚úÖ –°–æ–∑–¥–∞–Ω bot/.env - –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º!"
    echo "üîë –î–æ–±–∞–≤—å—Ç–µ BOT_TOKEN –∏ WEBAPP_URL"
fi

# –°–±–æ—Ä–∫–∞ TypeScript –¥–ª—è –±–æ—Ç–∞
echo "üî® –°–±–æ—Ä–∫–∞ Telegram Bot..."
cd bot
npm run build
cd ..

echo ""
echo "üéâ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo ""
echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. ü§ñ –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather"
echo "2. üìù –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ bot/.env —Å –≤–∞—à–∏–º —Ç–æ–∫–µ–Ω–æ–º"
echo "3. üåê –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –¥–æ–º–µ–Ω–µ —Å HTTPS"
echo "4. ‚ñ∂Ô∏è  –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É:"
echo ""
echo "   # Mini App:"
echo "   npm run dev"
echo ""
echo "   # Telegram Bot (–≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):"
echo "   cd bot && npm run dev"
echo ""
echo "üîó –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: SETUP_INSTRUCTIONS.md"
echo "üçΩÔ∏è –ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!" 