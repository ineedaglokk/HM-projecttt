#!/bin/bash

# üöÄ –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
# –•–∞—á–∞–ø—É—Ä–∏ –ú–∞—Ä–∏–∫–æ - Telegram Mini App

echo "üçû –ó–∞–ø—É—Å–∫ –•–∞—á–∞–ø—É—Ä–∏ –ú–∞—Ä–∏–∫–æ - Dev Server"
echo "======================================"

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "$(dirname "$0")/.."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "package.json" ]; then
    echo "‚ùå –§–∞–π–ª package.json –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
if [ ! -d "node_modules" ]; then
    echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
    npm install
    if [ $? -ne 0 ]; then
        echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
        exit 1
    fi
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è..."
npm run build > /dev/null 2>&1
if [ $? -ne 0 ]; then
    echo "‚ùå –ü—Ä–æ–µ–∫—Ç –Ω–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ —Å–Ω–∞—á–∞–ª–∞:"
    npm run build
    exit 1
fi

echo "‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è!"

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
echo ""
echo "üß™ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:"
echo "‚Ä¢ –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (/) - –≥–æ—Ä–æ–¥ —Å–≤–µ—Ä—Ö—É, –∞–¥—Ä–µ—Å–∞ –≤–Ω–∏–∑—É"
echo "‚Ä¢ –ü—Ä–æ—Ñ–∏–ª—å (/profile) - —Ç–æ–ª—å–∫–æ –ª–æ–≥–æ—Ç–∏–ø —Å–≤–µ—Ä—Ö—É"
echo "‚Ä¢ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (/edit-profile) - —Ç–æ–ª—å–∫–æ –ª–æ–≥–æ—Ç–∏–ø —Å–≤–µ—Ä—Ö—É"
echo "‚Ä¢ –ê–∫—Ü–∏–∏ (/promotions) - —Ç–æ–ª—å–∫–æ –ª–æ–≥–æ—Ç–∏–ø —Å–≤–µ—Ä—Ö—É"  
echo "‚Ä¢ –î–æ—Å—Ç–∞–≤–∫–∞ (/delivery) - —Ç–æ–ª—å–∫–æ –ª–æ–≥–æ—Ç–∏–ø —Å–≤–µ—Ä—Ö—É"
echo "‚Ä¢ –û—Ç–∑—ã–≤—ã (/review) - —Ñ–æ—Ä–º–∞ –æ—Ç–∑—ã–≤–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç"
echo "‚Ä¢ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (/booking) - —Ñ–æ—Ä–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"
echo ""

# –ü–æ–ª—É—á–∞–µ–º —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç
PORT=8081
while lsof -Pi :$PORT -sTCP:LISTEN -t >/dev/null ; do
    PORT=$((PORT + 1))
done

echo "üåê –°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω –Ω–∞: http://localhost:$PORT"
echo "üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ - –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –≤–∏–¥–Ω—ã —Å—Ä–∞–∑—É"
echo ""
echo "‚èπÔ∏è  –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C"
echo "======================================"
echo ""

# –ó–∞–ø—É—Å–∫–∞–µ–º dev-—Å–µ—Ä–≤–µ—Ä
npm run dev 