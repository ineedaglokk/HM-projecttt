# Система отзывов - Документация

## Что было реализовано

### 1. База данных отзывов (src/lib/database.ts)

Добавлен интерфейс `Review` с полями:
- `id` - уникальный идентификатор
- `userId` - ID пользователя
- `userName` - имя пользователя  
- `userPhone` - телефон пользователя
- `restaurantId` - ID ресторана
- `restaurantName` - название ресторана
- `restaurantAddress` - адрес ресторана
- `rating` - оценка (1-5 звезд)
- `text` - текст отзыва
- `sentiment` - тональность ('positive', 'negative', 'neutral')
- `status` - статус обработки ('pending', 'processed', 'resolved')
- `isPublic` - будет ли отзыв показываться публично
- `managerResponse` - ответ менеджера (опционально)
- `createdAt` - дата создания
- `processedAt` - дата обработки (опционально)

### 2. API для работы с отзывами (src/lib/botApi.ts)

Добавлены методы:
- `createReview()` - создание нового отзыва с анализом тональности
- `getRestaurantReviews()` - получение публичных отзывов ресторана
- `getReviewsStats()` - статистика отзывов
- `getUserReviews()` - отзывы пользователя
- `updateReviewStatus()` - обновление статуса отзыва

### 3. Компонент отображения отзывов (src/components/RestaurantReviews.tsx)

Новый компонент с функционалом:
- Отображение списка отзывов с оценками
- Показ статистики (средний рейтинг, количество отзывов)
- Адаптивный дизайн в стиле приложения
- Состояния загрузки и пустого списка
- Ответы менеджеров на отзывы

### 4. Интеграция в страницы

**Страница отзывов (src/pages/Review.tsx):**
- Сохранение отзывов в базу данных
- Анализ тональности отзыва
- Умная логика перенаправления (позитивные → внешние платформы, негативные → внутренняя обработка)

**Страница ресторанов (src/pages/Restaurants.tsx):**
- Кнопка "В приложении" для оставления отзыва
- Отображение отзывов для конкретного ресторана
- Интеграция компонента RestaurantReviews

### 5. Анализ тональности отзывов

Умный алгоритм определения тональности:
- **Позитивные**: 4-5 звезд без негативных слов
- **Негативные**: 1-2 звезды или наличие негативных слов
- **Нейтральные**: все остальные случаи

Словари ключевых слов:
- Негативные: плохо, ужас, отвратительно, холодный, невкусный, и др.
- Позитивные: отлично, вкусно, прекрасно, рекомендую, и др.

### 6. Тестовые данные

Созданы 4 тестовых отзыва для демонстрации:
- 2 позитивных отзыва для ресторана на Рождественской
- 1 позитивный отзыв для ресторана в СПб
- 1 нейтральный отзыв

## Как это работает

### Для пользователей:
1. Нажимают "Оставить отзыв" в приложении или "В приложении" на странице ресторана
2. Заполняют форму с оценкой и текстом
3. **Если отзыв позитивный** → предлагается оставить отзыв на Яндекс.Картах/2ГИС
4. **Если отзыв негативный** → сохраняется для внутренней обработки

### Для менеджеров:
1. Негативные отзывы автоматически создают уведомления
2. Можно отвечать на отзывы через `updateReviewStatus()`
3. Доступна статистика по отзывам каждого ресторана

### Хранение данных:
- Все отзывы сохраняются в localStorage
- Автоматическая очистка при переполнении (оставляет последние 30-50 отзывов)
- Подготовлена SQL схема для миграции на реальную БД

## Преимущества реализации

1. **Двойная выгода**: позитивные отзывы идут на публичные платформы, негативные обрабатываются внутренне
2. **Полная история**: все отзывы сохраняются для анализа и улучшения сервиса
3. **Умная обработка**: автоматический анализ тональности и соответствующее поведение
4. **Готовность к масштабированию**: подготовлена схема БД для продакшена
5. **Интуитивный UX**: пользователи не замечают сложности системы

## Следующие шаги

1. **Интеграция с Telegram ботом** для уведомлений менеджеров
2. **Админ-панель** для управления отзывами
3. **Расширенная аналитика** и отчеты
4. **Система бонусов** за честные отзывы
5. **Миграция на реальную БД** (PostgreSQL/MongoDB) 